# Remnawave Subscription Page Fork

## –†–µ–¥–∞–∫—Ç–æ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π Remnawave
–ü—Ä–æ–µ–∫—Ç –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ –ø—Ä–æ—Å—Ç–æ–µ –∏ –ª–µ–≥–∫–æ–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥–æ–≤, –ø–æ–¥ **xray-json** –∏ **mihomo**, –ø–∞—Ç—á –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è *Remnawave Subscription Page*

**–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–∞—Ç—á–∞ –¢–ì:** [dmzk-code](https://t.me/vitalii_aleksandriyskiy "–ü–æ–ª—É—á–∏—Ç—å –ø–∞—Ç—á")

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: 
- –°–æ–∑–¥–∞–Ω–∏–µ –ê–≤—Ç–æ-—Å–µ—Ä–≤–µ—Ä–æ–≤(–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞)
- –°–∫—Ä—ã—Ç–∏–µ —Å–µ—Ä–≤–µ—Ä–æ–≤ –∏–∑ –ø–æ–¥–ø–∏—Å–∫–∏
- –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞
- –ó–∞–º–µ–Ω–∞ select'–æ–≤ –≤ proxy-groups
- –£–¥–∞–ª–µ–Ω–∏–µ select'–æ–≤ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –î–æ–±–∞–≤–ª–µ–Ω—ã/–∏–∑–º–µ–Ω–µ–Ω—ã —Ñ–∞–π–ª—ã
- backend/src/modules/root/mihomo-layer.service.ts (–Ω–æ–≤—ã–π)
- backend/src/modules/root/root.service.ts
- backend/src/modules/root/root.module.ts
- backend/src/common/config/app-config/config.schema.ts
- backend/src/common/constants/index.ts
- backend/src/common/constants/ignored-headers.constant.ts


### –ß—Ç–æ –≤–æ–æ–±—â–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?
- –ö–æ–≥–¥–∞ –æ—Ç–≤–µ—Ç –Ω–∞ –ø–æ–¥–ø–∏—Å–∫—É –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ Mihomo YAML (—Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä—ã
  –∏/–∏–ª–∏ –ø—Ä–æ–∫—Å–∏-–≥—Ä—É–ø–ø), –æ–Ω –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –∏ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –∑–∞–Ω–æ–≤–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∞–≤–∏–ª:
  - –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –±–∞–ª–∞–Ω—Å/–ø–µ—Ä–µ–¥–µ–ª–∫–∞/—Å–∫—Ä—ã—Ç–∏–µ/–∑–∞–º–µ–Ω–∞/—É–¥–∞–ª–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–Ω—Ñ–∏–≥–∞.
  - —É–¥–∞–ª–µ–Ω–∏–µ —É–¥–∞–ª—è–µ—Ç —ç–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–æ–∫—Å–∏ –∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≥—Ä—É–ø–ø—ã –ø–æ–≤—Å—é–¥—É.
  - –Ω–æ–≤—ã–µ –≥—Ä—É–ø–ø—ã –≤—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ –ü–†–û–ö–°–ò –∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –ü–†–û–ö–°–ò, –µ—Å–ª–∏ –æ–Ω–∏
–Ω–µ —è–≤–ª—è—é—Ç—Å—è —Ü–µ–ª—å—é –∑–∞–º–µ–Ω—ã, —Å–∫—Ä—ã—Ç—ã –∏–ª–∏ —É–¥–∞–ª–µ–Ω—ã.

### –ö—É–¥–∞ –ø–æ–º–µ—Å—Ç–∏—Ç—å configMi.yaml?
- –ü–æ–º–µ—Å—Ç–∏—Ç–µ *configMi.yaml* –Ω–∞ —Ö–æ—Å—Ç –∏ —Å–º–æ–Ω—Ç–∏—Ä—É–π—Ç–µ –µ–≥–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä.
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –¥–ª—è env **MIHOMO_LAYER_CONFIG_PATH** –∑–Ω–∞—á–µ–Ω–∏–µ –ø—É—Ç–∏ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
- –ï—Å–ª–∏ **MIHOMO_LAYER_CONFIG_PATH** –Ω–µ –∑–∞–¥–∞–Ω, —Å–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å –≤—ã–ø–æ–ª–Ω–∏—Ç –ø–æ–∏—Å–∫
  *configMi.yaml* –≤ —Ä–∞–±–æ—á–µ–º –∫–∞—Ç–∞–ª–æ–≥–µ —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —á–∞—Å—Ç–∏ (process.cwd()).

### –ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (compose)
- –î–æ–±–∞–≤–ª—è–µ–º –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–º–∞ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–µ—Ä–≤–µ—Ä–Ω–æ–π —Å–ª—É–∂–±—ã.
- –î–æ–±–∞–≤–ª—è–µ–º env *MIHOMO_LAYER_CONFIG_PATH=/app/configMi.yaml*.
- –î–æ–±–∞–≤–ª—è–µ–º env *YAML_EDITOR_PREFIX=***/—Å–µ–∫—Ä–µ—Ç–Ω—ã–π/–ø—É—Ç—å/–¥–ª—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è–∫–æ–Ω—Ñ–∏–≥–∞**.

### –ü—Ä–∏–º–µ—Ä —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ (–∞–¥–∞–ø—Ç–∏—Ä—É–π—Ç–µ –∫ –≤–∞—à–µ–º—É —Ñ–∞–π–ª—É compose):

```
services:
    remnawave-subscription-page:
        image: remnawave/sub-page-patched:7.0.5-patched
        container_name: remnawave-subscription-page
        hostname: remnawave-subscription-page
        restart: always
        env_file:
          - .env
        environment:
          - MIHOMO_LAYER_CONFIG_PATH=/app/configMi.yaml
          - YAML_EDITOR_PREFIX=/—Å–µ–∫—Ä–µ—Ç–Ω—ã–π/–ø—É—Ç—å/–¥–ª—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è–ö–æ–Ω—Ñ–∏–≥–∞
        volumes:
          - /opt/remnawave/subscription/configMi.yaml:/app/configMi.yaml
        ports:
          - '127.0.0.1:3010:3010'
        networks:
          - remnawave-network
```

## –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Å–±–æ—Ä–∫–∏
1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –æ—Ñ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π *subscription-page* –≤ –ø–∞–ø–∫—É *fork/sub-page-patched*
2. –°–∫–∞—á–∞—Ç—å –ø–∞—Ç—á —Ñ–∞–π–ª—ã –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è *patch-files*
3. –ü–æ–º–µ—Å—Ç–∏—Ç—å –≤—Å–µ —Ñ–∞–π–ª—ã –∏–∑ *patch-files* –≤ –ø–∞–ø–∫—É —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º *fork/sub-page-patched* —Å –∑–∞–º–µ–Ω–æ–π —Ñ–∞–π–ª–æ–≤ 
4. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—ã –≤–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏ *fork* –¥–ª—è —Å–±–æ—Ä–∫–∏
```
docker build -t remnawave/sub-page-patched:7.0.5-patched -f sub-page-patched\Dockerfile sub-page-patched
```
```
docker save -o C:\Users\dmzk-code\fork\sub-page-patched.tar remnawave/sub-page-patched:7.0.5-patched
```
> [!IMPORTANT]
> –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Å–≤–æ–π –ø—É—Ç—å –∫ –ø–∞–ø–∫–µ *C:\Users\dmzk-code\fork*
> [!IMPORTANT]
> –ï—Å–ª–∏ –º–∞—à–∏–Ω–∞ —Å–ª–∞–±–∞—è, —Ç–æ –ª—É—á—à–µ —Å–æ–±–∏—Ä–∞—Ç—å –Ω–∞ —Å–≤–æ—ë–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ, Docker –¥–ª—è Windows.
5. –ó–∞–≥—Ä—É–∂–∞–µ–º –æ–±—Ä–∞–∑ –Ω–∞ —Å–µ—Ä–≤–µ—Ä *C:\Users\dmzk-code\fork\sub-page-patched.tar* –≤ */opt/remnawave/subscription*
6. –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª *configMi.yaml* –≤ */opt/remnawave/subscription*
7. –ü–æ–¥–≥—Ä—É–∂–∞–µ–º —Å–ª–æ–∏

```
docker load -i /opt/remnawave/subscription/sub-page-patched.tar
```
8. –í—ã–ø–æ–ª–Ω—è–µ–º –∫–æ–º–∞–Ω–¥—ã
```
cd /opt/remnawave/subscription && docker compose down && docker compose up -d && docker compose logs -f -t
```
> [!NOTE]
> –ï—Å–ª–∏ –Ω–µ—Ç —Ñ–∞–π–ª–∞ *configMi.yaml* –≤ */opt/remnawave/subscription* —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ –æ–±—ã—á–Ω–æ
## –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ configMi.yaml
```
balance:
  - name: "üì° [AUTO] - –û–±—ã—á–Ω—ã–µ"
    hidden: true
    type: load-balance
    strategy: sticky-sessions # –∏–ª–∏ round-robin
    visible: mihomo,xray
    input-proxies: #—Ç—É—Ç –º—ã –ø–µ—Ä–µ—á–µ—Å–ª—è–µ–º –∫–∞–∫–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ –±—É–¥—É—Ç –≤ –±–∞–ª–∞–Ω—Å–µ—Ä–µ –¥–ª—è –∞–≤—Ç–æ–≤—ã–±–æ—Ä–∞
      - "üá´üáÆ [B1] - –§–∏–Ω–ª—è–Ω–¥–∏—è"
      - "üá™üá™ [B1] - –≠—Å—Ç–æ–Ω–∏—è"
      - "üá©üá™ [B1] - –ì–µ—Ä–º–∞–Ω–∏—è"
      - "üá∫üá∏ [B1] - –°–®–ê"
      - "üáÆüáπ [B1] - –ò—Ç–∞–ª–∏—è"

  - name: "üîê [AUTO] - –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ"
    hidden: true
    type: load-balance
    strategy: sticky-sessions # –∏–ª–∏ consistent-hashing
    visible: mihomo,xray
    input-proxies:
      - "üá´üáÆ [K1] - –§–∏–Ω–ª—è–Ω–¥–∏—è"
      - "üá™üá™ [K1] - –≠—Å—Ç–æ–Ω–∏—è"
      - "üá©üá™ [K1] - –ì–µ—Ä–º–∞–Ω–∏—è"
      - "üá∫üá∏ [K1] - –°–®–ê"
      - "üáÆüáπ [K1] - –ò—Ç–∞–ª–∏—è"

  - name: "üîÜ [AUTO] - –°—Ç–∞–±–∏–ª—å–Ω—ã–µ –¥–µ–Ω—å"
    hidden: true
    type: load-balance
    strategy: sticky-sessions # –∏–ª–∏ consistent-hashing
    visible: xray
    input-proxies:
      - "üá´üáÆ [XT] - –§–∏–Ω–ª—è–Ω–¥–∏—è"
      - "üá™üá™ [XT] - –≠—Å—Ç–æ–Ω–∏—è"
      - "üá©üá™ [XT] - –ì–µ—Ä–º–∞–Ω–∏—è"
      - "üá∫üá∏ [XT] - –°–®–ê"
      - "üáÆüáπ [XT] - –ò—Ç–∞–ª–∏—è"

remake:
  - name: "üá´üáÆ [B1] - –§–∏–Ω–ª—è–Ω–¥–∏—è"
    hidden: true
    output-name: "üá´üáÆ [B1-WTL] - –§–∏–Ω–ª—è–Ω–¥–∏—è"
    type: fallback
    visible: mihomo,xray
    input-proxies:
      - "üá´üáÆ [B1] - –§–∏–Ω–ª—è–Ω–¥–∏—è"
      - "üá´üáÆ [WTL] - –§–∏–Ω–ª—è–Ω–¥–∏—è"

  - name: "üá™üá™ [B1] - –≠—Å—Ç–æ–Ω–∏—è"
    hidden: true
    output-name: "üá™üá™ [B1-WTL] - –≠—Å—Ç–æ–Ω–∏—è"
    type: fallback
    visible: mihomo,xray
    input-proxies:
      - "üá™üá™ [B1] - –≠—Å—Ç–æ–Ω–∏—è"
      - "üá™üá™ [WTL] - –≠—Å—Ç–æ–Ω–∏—è"

  - name: "üá©üá™ [B1] - –ì–µ—Ä–º–∞–Ω–∏—è"
    hidden: true
    output-name: "üá©üá™ [B1-WTL] - –ì–µ—Ä–º–∞–Ω–∏—è"
    type: fallback
    visible: mihomo,xray
    input-proxies:
      - "üá©üá™ [B1] - –ì–µ—Ä–º–∞–Ω–∏—è"
      - "üá©üá™ [WTL] - –ì–µ—Ä–º–∞–Ω–∏—è"

  - name: "üá∫üá∏ [B1] - –°–®–ê"
    hidden: true
    output-name: "üá∫üá∏ [B1-WTL] - –°–®–ê"
    type: fallback
    visible: mihomo,xray
    input-proxies:
      - "üá∫üá∏ [B1] - –°–®–ê"
      - "üá∫üá∏ [WTL] - –°–®–ê"

hidden:
  input-proxies: #—Ç—É—Ç –º—ã –ø–µ—Ä–µ—á–µ—Å–ª—è–µ–º –∫–∞–∫–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–µ –±—É–¥—É—Ç –≤–∏–¥–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Ç–∞–∫ –∫–∞–∫ –∫ –Ω–∏–º –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ fallback –≤ —Å–ª—É—á–∞–µ –µ—Å–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω—É–∂–Ω–æ–º—É —Å–µ—Ä–≤–µ—Ä—É
    - "üá´üáÆ [WTL] - –§–∏–Ω–ª—è–Ω–¥–∏—è"
    - "üá™üá™ [WTL] - –≠—Å—Ç–æ–Ω–∏—è"
    - "üá©üá™ [WTL] - –ì–µ—Ä–º–∞–Ω–∏—è"
    - "üá∫üá∏ [WTL] - –°–®–ê"

replace:
  proxies: #—Ç—É—Ç –º—ã –ø–µ—Ä–µ—á–µ—Å–ª—è–µ–º –∫–∞–∫–æ–π select –≤ proxy-groups –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ –¥—Ä—É–≥–æ–π select
    "üì° [B1] - –û–±—ã—á–Ω—ã–µ": "üì° [AUTO] - –û–±—ã—á–Ω—ã–µ"
    "üîê [K1] - –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ": "üîê [AUTO] - –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ"
    "üîÜ [XT] - –°—Ç–∞–±–∏–ª—å–Ω—ã–µ –¥–µ–Ω—å": "üîÜ [AUTO] - –°—Ç–∞–±–∏–ª—å–Ω—ã–µ –¥–µ–Ω—å"
    "üá´üáÆ [B1] - –§–∏–Ω–ª—è–Ω–¥–∏—è": "üá´üáÆ [B1-WTL] - –§–∏–Ω–ª—è–Ω–¥–∏—è"
    "üá™üá™ [B1] - –≠—Å—Ç–æ–Ω–∏—è": "üá™üá™ [B1-WTL] - –≠—Å—Ç–æ–Ω–∏—è"
    "üá©üá™ [B1] - –ì–µ—Ä–º–∞–Ω–∏—è": "üá©üá™ [B1-WTL] - –ì–µ—Ä–º–∞–Ω–∏—è"
    "üá∫üá∏ [B1] - –°–®–ê": "üá∫üá∏ [B1-WTL] - –°–®–ê"

delete:
  proxies: #—Ç—É—Ç –º—ã –ø–µ—Ä–µ—á–µ—Å–ª—è–µ–º —á—Ç–æ —Ö–æ—Ç–∏–º —É–¥–∞–ª–∏—Ç—å –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é
    - "üì° [B1] - –û–±—ã—á–Ω—ã–µ"
    - "üîê [K1] - –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ"
    - "üîÜ [XT] - –°—Ç–∞–±–∏–ª—å–Ω—ã–µ –¥–µ–Ω—å"
    - "üåó [WTL] - –¢–µ–ª–µ—Ñ–æ–Ω –Ω–æ—á—å"  
```
> [!TIP]
> –ü–∞—Ç—á —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª—Å—è –Ω–∞ –≤–µ—Ä—Å–∏–∏ 7.0.5.
